import _winreg as winreg
import itertools
import serial

class GetSerialPorts(object):
    # list contains all port device info
    portList = []
    IterationError=''
    def enumerate_serial_ports(self):
        """ Uses the Win32 registry to return a iterator of serial 
            (COM) ports existing on this computer.
        """
        path = 'HARDWARE\\DEVICEMAP\\SERIALCOMM'
        try:
            key = winreg.OpenKey(winreg.HKEY_LOCAL_MACHINE, path)
        except WindowsError:
            raise self.IterationError

        for i in itertools.count():
            try:
                val = winreg.EnumValue(key, i)
                self.portList.append(val)
            except EnvironmentError:
                break

        winreg.CloseKey(key)

    def port_list(self):
        self.portList=[]
        for x in range(len(self.portList)):
            tmp = self.portList[x]
            print tmp[0]
            print str(tmp[1])
    
class OpenSerialPorts(object):
    def __init__(self, port, baud, databit, stopbit):
        self.port = port
        self.baud = baud
        self.databit = databit
        self.stopbit = stopbit
    
    def Open(self):
        uart = serial.Serial(port=self.port, baudrate=self.baud, bytesize=self.databit, stopbits=self.stopbit)   
        uart.open()
        
        
